{% include 'begin.html' %}
{% include 'header.html' %}
{% include 'voice.html' %}

<style>
body, html {
    overflow-x: hidden;
    overflow-y: auto;
    max-width: 100vw;
}
</style>

<h1> All the slides </h1>

<br><br><br><br>

{% for i in range(0, number_diapos) -%}

        <img id="thumb{{i}}" src="thumbnails/thumb_{{i}}.png" class="thumbnail" data-diapo="{{i}}" />
        <span class="slide_index" id="d{{i}}">{{i}}</span>

{% endfor %}

<div id="bottom_spacer"></div>

<script>

var socket = io.connect();

// Override overflow settings from diapo.html to enable scrolling
// Use a slight delay to ensure this runs after diapo.html's overflow:hidden
setTimeout(function() {
    $('body').css({'overflow-y': 'auto !important', 'overflow-x': 'hidden !important'});
    $('html').css({'overflow-y': 'auto !important', 'overflow-x': 'hidden !important'});
    // Also set via setAttribute to ensure it takes effect
    document.body.style.setProperty('overflow-y', 'auto', 'important');
    document.body.style.setProperty('overflow-x', 'hidden', 'important');
    document.documentElement.style.setProperty('overflow-y', 'auto', 'important');
    document.documentElement.style.setProperty('overflow-x', 'hidden', 'important');
}, 100);

// Thumbnail dimensions (from Puppeteer: 1200x800, displayed at 50% = 600x400)
var thumbWidth = 600   // 50% of 1200
var thumbHeight = 400  // 50% of 800

// Style slide indices
$('.slide_index').css({
    'position': 'absolute',
    'color': '#333',
    'background': 'transparent',
    'padding': '5px 10px',
    'border-radius': '3px',
    'pointer-events': 'none',
    'z-index': '1000',
    'font-weight': 'bold',
    'text-shadow': '1px 1px 2px rgba(255, 255, 255, 0.8), -1px -1px 2px rgba(255, 255, 255, 0.8)'
})

// Style all thumbnails
$('.thumbnail').css({
    'position': 'absolute',
    'width': thumbWidth + 'px',
    'height': thumbHeight + 'px',
    'cursor': 'pointer',
    'border': '2px solid #ccc',
    'box-shadow': '0 4px 8px rgba(0,0,0,0.3)'
})

// Position thumbnails vertically and center them horizontally
for (var i = 0; i < {{number_diapos}}; i++){
    var posY = 200 + (thumbHeight + 115) * i  // 115px spacing between thumbnails
    var posX = (window.innerWidth - thumbWidth) / 2  // Center horizontally

    $('#thumb' + i).css({'top' : posY + 'px', 'left' : posX + 'px'})
    $('#d' + i).css({
        'top' : (posY - 35) + 'px',
        'left' : (posX + thumbWidth/2) + 'px',
        'font-size' : '20px',
        'transform': 'translateX(-50%)',
        'font-weight': 'bold'
    })
}

// Add bottom spacer to create margin after last thumbnail
var lastThumbY = 200 + (thumbHeight + 115) * ({{number_diapos}} - 1) + thumbHeight
$('#bottom_spacer').css({
    'position': 'absolute',
    'top': (lastThumbY + 200) + 'px',
    'height': '1px',
    'width': '100%'
})

// Click on thumbnail to navigate to that slide
$('.thumbnail').click(function(){
      var diapoNum = parseInt($(this).attr('data-diapo'))
      var diapoId = 'd' + diapoNum
      socket.emit('numdiap', diapoNum)
      location.replace(diapoId)
})

// Scroll to the current slide
$(document).ready(function () {
    // Check if URL contains a hashtag (ex: #d5)
    if (window.location.hash) {
        const target = window.location.hash;
        setTimeout(function () {
            const targetElement = $(target.replace('d', 'thumb'))[0];
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }, 500);
    }
});

// Recenter thumbnails on window resize
function repositionThumbnails() {
    for (var i = 0; i < {{number_diapos}}; i++){
        var posY = 200 + (thumbHeight + 115) * i
        var posX = (window.innerWidth - thumbWidth) / 2

        $('#thumb' + i).css({'left' : posX + 'px'})
        $('#d' + i).css({
            'top' : (posY - 35) + 'px',
            'left' : (posX + thumbWidth/2) + 'px'
        })
    }
}

window.addEventListener('resize', function() {
    setTimeout(repositionThumbnails, 100)
})

</script>


{% include 'diapo.html' %}
{% include 'math.html' %}
{% include 'scroll_socket.html' %}
{% include 'end.html' %}
