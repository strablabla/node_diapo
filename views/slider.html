<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

<script>

$('#content').append($('<div/>').attr('id','slider').css({'position':'absolute','top':'750px'}))
$('#content').append($('<div/>').attr('id','slider_value').css({'position':'absolute','top':'780px'}))
$('#content').append($('<div/>').attr('id','current_diapo'))
$("#slider_value").hide() //

var drag_slider = d3.behavior.drag()
    .origin(function(d) {  return d })
    .on("dragstart", dragstarted)
    .on("drag", function(d) {
        if (d.dir == "x"){
            d.action();
            var frame_part = '<iframe  id="frame0" src="{}" style="width:1600px;height:950px" >  </iframe>'.format(numdiap())
            var title_part = '<br><br><br><br><center><h1>{}</h1></center>'.format(numdiap())
            $('#current_diapo').html(frame_part + title_part)
            $('#current_diapo').css({'position':'absolute',
                                      'top':'450px',
                                      'left': d3.event.x + 60,
                                      '-webkit-transform': 'scale(0.3)',
                                      'transform': 'scale(0.3)',
                                      '-webkit-transform-origin': '0 0',
                                      'transform-origin': '0 0'
                                    })
            return d3.select(this).attr("cx", d.x  = d3.event.x ) ;
            }
        else if (d.dir == "y"){
            $("#slider_value").html(d3.event.y);
            d.action();
            return d3.select(this).attr("cy", d.y  = d3.event.y);
            }
    })
    .on("dragend", dragended);

var length_slider = 1000

var svg = d3.select("#slider")
            .append("svg")
            .attr("width", length_slider)
            .attr("height", 100);

var chgx = function(){$("#slider_value").html(d3.event.x)}
var chgy = function(){$("#slider_value").html(d3.event.y)}

var slide = function(data, name_svg){ // Vertical or horizontal slider

    slider_line = function(data){
          var svg_slider_line = name_svg
            .selectAll("svg_slider_line")
            .data(data)
            .enter()
            .append("line")
            .attr('x1', function(d){return d.xbar}) //
            .attr('y1', function(d){return d.ybar})
            .attr('x2', function(d){if ( d.dir=="x" ){ return d.slength + d.xbar } else { return d.xbar }}) //
            .attr('y2', function(d){if ( d.dir=="y" ){ return d.slength + d.ybar } else { return d.ybar }})
            .attr('stroke', function(d){return d.col})
            .attr('stroke-width', '4px')
        }

    slider_button = function(data){
        var slider_butt = name_svg
          .selectAll("svg_slider_button")
          .data(data)
          .enter()
          .append("ellipse")       // attach an ellipse
          .attr("cx", function(d){return d.x})           // position the x-centre
          .attr("cy", function(d){return d.y})           // position the y-centre
          .attr("rx", 7)           // set the x radius
          .attr("ry", 7)           // set the y radius
          .attr("fill", function(d){return d.col})
          .attr("class", "slide")
          .call(drag_slider);
        }
    slider_line(data);
    slider_button(data);
}

function dragstarted(d) {
    d3.event.sourceEvent.stopPropagation();
    d3.select(this).classed("dragging", true);
}

function dragended(d) {
    d3.select(this).classed("dragging", false);
    socket.emit('numdiap', numdiap().slice('d')[1]) // send new num of diap..
    window.location.href = numdiap();
    }

function numdiap(){
    /*
    Return the num of the current diapo..
    */
    var name_diap = 'd' + parseInt(parseFloat($("#slider_value").html())/length_slider*diapo_max)
    return name_diap
}



</script>
